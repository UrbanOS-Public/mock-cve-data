import VehicleManager from './VehicleManager';
import { vehicleFactory } from './__mocks__/Vehicle';

describe('VehicleManager', () => {
    it('Calls v.crash on only the first vehicle if none are crashed', () => {
        const v1 = vehicleFactory({ isCrashed: false });
        const v2 = vehicleFactory({ isCrashed: false });
        const vm = new VehicleManager([v1, v2]);
        vm.crashAVehicle();
        expect(v1.crash).toHaveBeenCalledTimes(1);
        expect(v2.crash).toHaveBeenCalledTimes(0);
    });
    it('Calls v.crash on only the 3rd vehicle if 2 are crashed', () => {
        const v1 = vehicleFactory({ isCrashed: true });
        const v2 = vehicleFactory({ isCrashed: true });
        const v3 = vehicleFactory({ isCrashed: false });
        const vm = new VehicleManager([v1, v2, v3]);
        vm.crashAVehicle();
        expect(v1.crash).toHaveBeenCalledTimes(0);
        expect(v2.crash).toHaveBeenCalledTimes(0);
        expect(v3.crash).toHaveBeenCalledTimes(1);
    });
    it('Returns the ID of the vehicle crashed', () => {
        const v1 = vehicleFactory({ isCrashed: false, vehicleId: 'fake-id' });
        const vm = new VehicleManager([v1]);
        expect(vm.crashAVehicle()).toBe('fake-id');
    });
    it('Returns undefined if no vehicle was crashed', () => {
        const v1 = vehicleFactory({ isCrashed: true });
        const v2 = vehicleFactory({ isCrashed: true });
        const vm = new VehicleManager([v1, v2]);
        expect(vm.crashAVehicle()).toBeUndefined();
    });

    it('throws an error when constructed with no vehicles', () => {
        expect(() => new VehicleManager([])).toThrowError(
            /VehicleManager constructed with no Vehicles/,
        );
    });

    it('#resetVehicles Call reset function for each vehicle', () => {
        const v1 = vehicleFactory({ isCrashed: true });
        const v2 = vehicleFactory({ isCrashed: true });
        const vm = new VehicleManager([v1, v2]);

        vm.resetVehicles();

        expect(v1.reset).toHaveBeenCalledTimes(1);
        expect(v2.reset).toHaveBeenCalledTimes(1);
    });
});
