import CVEPathData, { PathPoint } from './CVEPathData';
import { v4 as uuidv4 } from 'uuid';

interface VehicleLocation extends PathPoint {
    pathId: string;
    vehicleId: string;
}

export default class Vehicle {
    private vehicleId: string;
    private vehiclePoint: number;
    private pathLength: number;

    constructor(private pathID: string, private pathData: CVEPathData) {
        this.vehicleId = uuidv4();
        this.vehiclePoint = 0;
        this.pathLength = pathData.getPath(pathID).length;
    }

    private getPointOnPath(point: number) {
        return this.pathData.getPath(this.pathID)[point];
    }

    public advanceOnPath(): void {
        this.vehiclePoint + 1 === this.pathLength
            ? (this.vehiclePoint = 0)
            : (this.vehiclePoint += 1);
    }

    public getCurrentLocation(): VehicleLocation {
        return {
            pathId: this.pathID,
            vehicleId: this.vehicleId,
            ...this.getPointOnPath(this.vehiclePoint),
        };
    }
}
