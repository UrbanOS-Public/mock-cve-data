# mock-cve-data

### Getting Started

-   `npm install` from the root of the repository will install the needed dependencies
-   In the extensions pane, search for `@recommended`, and install the recommended extensions
    -   All team code linting / formatting will happen upon saving
-   `npm run watch` will spin up the api in watch mode (code changes will refresh)

### Testing

Endpoints are tested with jest and the supertest library. An example is available
in the `app.test.ts` file.

-   `npm run test:watch` will run all `*.test.ts` files in watch mode
-   `npm run view:coverage` will startup a server to serve the coverage report
    for you to view in your browser

### Deployment

Deployment to the azure environment happens manually with the following
commands. (You'll need to be configured to have azure cluster access in advance)

-   Build a docker image: `docker build . -t smartcitiesdata/mock-cve-data:latest`
-   Push that new image to docker hub: `docker push smartcitiesdata/mock-cve-data:latest`
-   Remove existing mock-cve-data release: `helm uninstall mock-cve-data -n urban-os-demo-services`
-   Helm install a new release: `helm install mock-cve-data ./chart -n urban-os-demo-services --create-namespace`

**note:** It'd be nice if we could just upgrade the helm release, but that hasn't been
pulling a new image even though the pull policy in the chart is set to Always

-   Upgrading the api command: `helm upgrade mock-cve-data ./chart -n urban-os-demo-services`

### API Dependencies Note

-   Anything needed by typescript to build (including `@types` packages) need to
    be included in the `dependencies`, not the `devDependencies`. This could be
    changed to be more conventional, but the dockerfile steps would also need
    to be updated. This is because at this time, the docker image performs a
    typescript build in addition to starting the app.
